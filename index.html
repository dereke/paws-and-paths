<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Paws & Paths Dog Walks | Premium Canine Adventures</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        
        html { scroll-behavior: smooth; }
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            overflow-x: hidden; 
            background-color: #020617; 
            color: #f8fafc;
            font-size: clamp(14px, 1.1vw, 16px);
            letter-spacing: -0.01em;
        }
        
        .hero-gradient { 
            background: radial-gradient(circle at 0% 0%, #064e3b 0%, #020617 40%, #020617 100%); 
        }

        /* CARD STYLES */
        .premium-card {
            background: #0f172a;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.5s cubic-bezier(0.16, 1, 0.3, 1);
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 1.5rem !important;
            border-radius: 1.5rem !important;
            min-height: 360px;
            overflow: hidden;
            cursor: pointer;
        }

        .premium-card:hover {
            transform: translateY(-5px);
            border-color: rgba(34, 197, 94, 0.3);
            background: #1e293b;
        }

        .diamond-mogul-card {
            background: linear-gradient(145deg, #1e1b4b 0%, #020617 100%) !important;
            border: 2px solid rgba(234, 179, 8, 0.8) !important;
            box-shadow: 0 0 40px rgba(234, 179, 8, 0.2);
            transform: scale(1.02);
            z-index: 10;
        }

        .diamond-mogul-card::before {
            content: "";
            position: absolute;
            inset: 0;
            background: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill='%23FFFFFF' d='M100 0L110 90L200 100L110 110L100 200L90 110L0 100L90 90Z'/%3E%3C/svg%3E");
            background-size: 40px 40px;
            opacity: 0.08;
            animation: sparkle-float 15s linear infinite;
        }

        @keyframes sparkle-float {
            0% { background-position: 0 0; }
            100% { background-position: 400px 400px; }
        }

        .fancy-icon-container {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        .icon-base { 
            font-size: 2.2rem; 
            opacity: 0.8;
            filter: drop-shadow(0 0 8px currentColor);
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .massive-crown-right {
            position: absolute !important;
            right: -10px !important;
            top: -5px !important;
            font-size: 8rem !important;
            z-index: 5;
            opacity: 0.3;
            color: #eab308;
            transform: rotate(15deg);
            transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        /* ICON ANIMATIONS */
        .anim-bounce { animation: iconBounce 0.6s ease; }
        .anim-sway { animation: iconSway 0.8s ease-in-out; }
        .anim-spin { animation: iconSpin 0.7s cubic-bezier(0.4, 0, 0.2, 1); }
        .anim-shake { animation: iconShake 0.5s ease; }
        .anim-pulse { animation: iconPulse 0.6s ease-out; }
        .anim-crown { animation: crownGrand 1.2s cubic-bezier(0.17, 0.67, 0.83, 0.67); }

        @keyframes iconBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        @keyframes iconSway {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(15deg); }
            75% { transform: rotate(-15deg); }
        }
        @keyframes iconSpin {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.4); }
            100% { transform: rotate(360deg) scale(1); }
        }
        @keyframes iconShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        @keyframes iconPulse {
            0% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.5); opacity: 1; filter: brightness(1.5); }
            100% { transform: scale(1); opacity: 0.8; }
        }
        @keyframes crownGrand {
            0% { transform: rotate(15deg) scale(1); opacity: 0.3; }
            30% { transform: rotate(0deg) scale(1.3); opacity: 1; filter: drop-shadow(0 0 30px #eab308); }
            100% { transform: rotate(15deg) scale(1); opacity: 0.3; }
        }

        .card-content-offset { 
            margin-top: 0.5rem; 
            padding-right: 0.5rem; 
            z-index: 20;
        }

        .availability-badge { 
            font-size: 0.6rem; 
            text-transform: uppercase; 
            font-weight: 800; 
            padding: 0.25rem 0.5rem; 
            border-radius: 6px; 
            display: inline-block; 
            margin-bottom: 0.75rem; 
        }

        .card-title { font-size: 1.15rem; font-weight: 700; margin-bottom: 0.25rem; line-height: 1.2; }
        .card-price { font-size: 1.75rem; font-weight: 800; color: #fff; margin-bottom: 0.5rem; }
        .card-price::before { content: '£'; }
        .card-desc { font-size: 0.8rem; color: #94a3b8; line-height: 1.5; margin-bottom: 1.25rem; flex-grow: 1; }
        
        .card-btn { 
            font-size: 0.7rem; 
            padding: 0.85rem 0.5rem; 
            text-transform: uppercase; 
            letter-spacing: 0.1em; 
            font-weight: 700; 
            border-radius: 0.75rem; 
            width: 100%; 
            transition: all 0.3s; 
            margin-top: auto; 
            cursor: pointer; 
            border: none;
            position: relative;
            z-index: 30;
            display: block;
            text-align: center;
        }
        
        /* DESKTOP 3x3 GRID */
        @media (min-width: 1024px) {
            .responsive-grid { 
                display: grid; 
                grid-template-columns: repeat(3, 1fr); 
                gap: 2rem; 
            }
        }

        /* MOBILE/TABLET FLEXIBILITY */
        @media (max-width: 1023px) {
            .responsive-grid { 
                display: grid; 
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); 
                gap: 1.5rem; 
            }
        }

        @media (max-width: 640px) {
            .responsive-grid { grid-template-columns: 1fr; }
            .hero-gradient h1 { font-size: 3.5rem; }
        }

        /* MODALS */
        .modal-overlay { 
            display: none; 
            position: fixed; 
            inset: 0; 
            background: rgba(2, 6, 23, 0.95); 
            backdrop-filter: blur(12px); 
            z-index: 100; 
            align-items: center; 
            justify-content: center; 
            padding: 1rem;
        }
        
        .modal-content-container {
            background: #0f172a;
            border-radius: 1.5rem;
            width: 100%;
            max-width: 500px;
            border: 1px solid rgba(255,255,255,0.1);
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        .modal-header { padding: 1.5rem 1.5rem 1rem; text-align: center; }
        .modal-body { padding: 0 1.5rem; overflow-y: auto; flex-grow: 1; }
        .modal-footer { padding: 1.25rem; border-top: 1px solid rgba(255,255,255,0.05); background: #0f172a; display: flex; flex-direction: column; gap: 0.5rem; }

        .selection-card {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.05);
            padding: 1rem;
            border-radius: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.75rem;
            min-height: 80px;
        }
        .selection-card.selected { border-color: #22c55e; background: rgba(34, 197, 94, 0.1); }

        #success-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: #22c55e;
            z-index: 200;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            padding: 2rem;
            text-align: center;
        }
    </style>
</head>
<body>

    <nav class="fixed w-full z-50 bg-black/20 backdrop-blur-xl border-b border-white/5">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-12">
            <div class="flex justify-between h-16 sm:h-20 items-center">
                <a href="#home" class="flex items-center gap-2 group">
                    <div class="w-8 h-8 sm:w-10 sm:h-10 bg-green-500/10 border border-green-500/20 rounded-lg sm:rounded-xl flex items-center justify-center text-green-500">
                        <i class="fas fa-paw text-sm sm:text-base"></i>
                    </div>
                    <span class="font-bold text-sm sm:text-lg uppercase tracking-widest">Paws & Paths</span>
                </a>
                <button onclick="document.getElementById('subscriptions').scrollIntoView()" class="bg-white text-black px-4 sm:px-6 py-2 rounded-full font-bold text-[10px] uppercase tracking-widest hover:bg-green-500 hover:text-white transition-colors">View Plans</button>
            </div>
        </div>
    </nav>

    <header id="home" class="hero-gradient min-h-[60vh] flex items-center pt-20">
        <div class="max-w-7xl mx-auto px-6 sm:px-12 w-full text-center">
            <h1 class="text-6xl sm:text-8xl font-extrabold tracking-tighter mb-4 leading-tight">Adventure <br><span class="text-green-500">Awaits.</span></h1>
            <p class="text-slate-400 max-w-xl mx-auto text-sm sm:text-lg">Professional walking services for the refined Stroud canine. Safety-certified care with premium video pupdates.</p>
        </div>
    </header>

    <section id="subscriptions" class="py-12 sm:py-20">
        <div class="max-w-7xl mx-auto px-4 sm:px-12">
            <div class="flex flex-col sm:flex-row justify-center mb-10 sm:mb-16 gap-3 max-w-md mx-auto">
                <button onclick="showTab('walks')" id="btn-walks" class="flex-1 px-8 py-4 bg-slate-900 rounded-xl font-bold text-[10px] uppercase tracking-widest border border-white/5 transition-all">Service Plans</button>
                <button onclick="showTab('addons')" id="btn-addons" class="flex-1 px-8 py-4 bg-slate-900 rounded-xl font-bold text-[10px] uppercase tracking-widest border border-white/5 transition-all">Add-ons</button>
            </div>

            <div id="walks-tab" class="tab-content">
                <div class="responsive-grid" id="walks-grid"></div>
            </div>
            <div id="addons-tab" class="tab-content hidden">
                <div class="responsive-grid" id="addons-grid"></div>
            </div>
        </div>
    </section>

    <!-- STEP 1: ROUTE SELECTION -->
    <div id="route-selection-modal" class="modal-overlay">
        <div class="modal-content-container">
            <div class="modal-header">
                <span class="text-blue-500 font-bold text-[10px] uppercase tracking-[0.3em]">Step 1: Location</span>
                <h3 class="text-xl sm:text-2xl font-bold mt-1">Pick a Stroud Route</h3>
            </div>
            <div class="modal-body">
                <div id="route-list-container"></div>
            </div>
            <div class="modal-footer">
                <button id="route-next-btn" onclick="goToAddons()" disabled class="w-full bg-slate-800 text-slate-500 py-4 rounded-xl font-black text-[10px] uppercase tracking-widest transition-all">Select a Route</button>
                <button onclick="closeModals()" class="text-slate-500 font-bold text-[10px] uppercase py-2 hover:text-white transition-colors text-center">Cancel</button>
            </div>
        </div>
    </div>

    <!-- STEP 2: ADD-ONS -->
    <div id="addon-suggestion-modal" class="modal-overlay">
        <div class="modal-content-container">
            <div class="modal-header">
                <span class="text-green-500 font-bold text-[10px] uppercase tracking-[0.3em]">Step 2: Extras</span>
                <h3 class="text-xl sm:text-2xl font-bold mt-1">Add Premium Care?</h3>
            </div>
            <div class="modal-body">
                <div id="addon-list-container"></div>
            </div>
            <div class="modal-footer">
                <button onclick="goToCheckout()" class="w-full bg-white text-black py-4 rounded-xl font-black text-[10px] uppercase tracking-widest hover:bg-green-500 hover:text-white">Continue to Checkout</button>
                <button onclick="goToCheckout()" class="text-slate-500 font-bold text-[10px] uppercase py-2 hover:text-white transition-colors text-center">Skip</button>
            </div>
        </div>
    </div>

    <!-- STEP 3: CHECKOUT -->
    <div id="payment-modal" class="modal-overlay">
        <div class="bg-slate-900 p-8 rounded-[2rem] w-full max-w-sm text-center border border-white/10 mx-auto shadow-2xl">
            <h3 class="text-2xl font-bold mb-1">Finalise Order</h3>
            <p id="checkout-display-name" class="text-green-500 font-black text-[10px] uppercase tracking-widest mb-4"></p>
            <div class="text-5xl font-black mb-1 tracking-tighter" id="checkout-amount"></div>
            <div id="checkout-items-list" class="text-[10px] text-slate-500 uppercase font-bold mb-4"></div>
            <div id="checkout-route-display" class="text-[9px] text-blue-400 uppercase font-bold mb-6 bg-blue-500/10 py-2 rounded-lg"></div>
            
            <div class="mb-6 text-left">
                <label class="text-[10px] uppercase font-bold text-slate-500 mb-2 block">Your Email</label>
                <input type="email" id="user-email" oninput="validateEmail()" placeholder="owner@email.com" 
                    class="w-full bg-slate-800 border border-white/5 rounded-xl px-4 py-3 text-sm text-white focus:outline-none focus:border-green-500 transition-colors">
            </div>

            <button id="confirm-btn" disabled onclick="handlePurchase()" 
                class="w-full bg-slate-800 text-slate-500 py-4 rounded-2xl font-black text-xs uppercase tracking-widest transition-all">
                Confirm & Pay
            </button>
            <button onclick="closeModals()" class="text-slate-500 font-bold text-[10px] uppercase mt-4 block w-full hover:text-white">Back</button>
        </div>
    </div>

    <!-- SUCCESS -->
    <div id="success-overlay">
        <canvas id="confetti-canvas"></canvas>
        <div class="relative z-10">
            <h2 class="text-white text-6xl sm:text-8xl font-black tracking-tighter italic drop-shadow-2xl">BOOKED!</h2>
            <p class="text-white/90 font-bold uppercase tracking-[0.4em] text-[10px] sm:text-xs mt-6 border-t border-white/20 pt-4">Adventure starts soon.</p>
        </div>
    </div>

    <script>
        const inventory = {
            walks: [
                { id: 'p-1', icon: 'fas fa-baby-carriage', name: 'Junior Explorer', price: 15, color: 'text-blue-400', desc: 'Short, gentle socialization walks for puppies under 6 months.', stock: 4, anim: 'anim-bounce' },
                { id: 'p-2', icon: 'fas fa-tree', name: 'Meadow Wander', price: 25, color: 'text-green-400', desc: 'The classic 60-minute nature walk through Stroud\'s commons.', stock: 8, anim: 'anim-sway' },
                { id: 'p-3', icon: 'fas fa-users', name: 'Pack Hike', price: 35, color: 'text-pink-400', desc: 'High-energy social group adventure for friendly dogs.', stock: 6, anim: 'anim-shake' },
                { id: 'p-4', icon: 'fas fa-history', name: 'Golden Stroll', price: 40, color: 'text-orange-400', desc: 'Paced perfectly for senior dogs needing extra comfort.', stock: 5, anim: 'anim-pulse' },
                { id: 'p-9', icon: 'fas fa-crown', name: 'Diamond Mogul', price: 110, color: 'text-yellow-500', desc: 'Unlimited priority walks with all premium extras included.', stock: 2, isDiamond: true, anim: 'anim-crown' },
                { id: 'p-5', icon: 'fas fa-volleyball-ball', name: 'Backyard Buddy', price: 20, color: 'text-red-400', desc: '30 mins of fetch and garden games. Great for high-energy pups!', stock: 5, anim: 'anim-bounce' },
                { id: 'p-6', icon: 'fas fa-star', name: 'Top Dog Elite', price: 65, color: 'text-yellow-400', desc: 'Solo walk with full GPS tracking and premium hydration.', stock: 3, anim: 'anim-spin' },
                { id: 'p-7', icon: 'fas fa-calendar-alt', name: 'Weekend Warrior', price: 75, color: 'text-purple-400', desc: 'Priority Saturday/Sunday sessions for busy owners.', stock: 2, anim: 'anim-pulse' },
                { id: 'p-8', icon: 'fas fa-home', name: 'Home Sweet Home', price: 85, color: 'text-indigo-400', desc: 'Walking plus 30 mins of post-walk play and feeding.', stock: 4, anim: 'anim-sway' }
            ],
            addons: [
                { id: 'a-1', icon: 'fas fa-video', name: 'Cinema Pupdate', price: 5, color: 'text-blue-400', desc: 'HD video highlights sent to your phone.', anim: 'anim-spin' },
                { id: 'a-2', icon: 'fas fa-shower', name: 'Fresh-Paw Finish', price: 8, color: 'text-cyan-400', desc: 'Full wash & dry service after the walk.', anim: 'anim-bounce' },
                { id: 'a-3', icon: 'fas fa-cookie-bite', name: 'Bark-ery Box', price: 5, color: 'text-pink-300', desc: 'A box of fresh, organic local treats.', anim: 'anim-pulse' },
                { id: 'a-4', icon: 'fas fa-location-crosshairs', name: 'Live GPS Ping', price: 7, color: 'text-red-400', desc: 'Watch your dog\'s route in real-time.', anim: 'anim-shake' }
            ],
            routes: [
                { id: 'r-1', name: 'Rodborough Common', note: 'Views & Cows', color: 'text-orange-400' },
                { id: 'r-2', name: 'Stratford Park', note: 'Paved Paths', color: 'text-emerald-400' },
                { id: 'r-3', name: 'Stroudwater Canal', note: 'Flat & Shady', color: 'text-sky-400' },
                { id: 'r-4', name: 'Slad Valley Trails', note: 'Wild Woods', color: 'text-amber-600' }
            ]
        };

        let currentSelection = { main: null, addons: [], route: null };

        // Simple confetti system
        class ConfettiParticle {
            constructor(canvas) {
                this.canvas = canvas;
                this.ctx = canvas.getContext('2d');
                this.colors = ['#ffffff', '#fcd34d', '#f472b6', '#60a5fa', '#34d399', '#eab308'];
                this.reset();
            }
            reset() {
                const fromLeft = Math.random() > 0.5;
                this.x = fromLeft ? -20 : this.canvas.width + 20;
                this.y = this.canvas.height;
                const angle = fromLeft ? (Math.random() * -30 - 35) * (Math.PI / 180) : (Math.random() * 30 + 215) * (Math.PI / 180);
                const power = 8 + Math.random() * 12;
                this.vx = Math.cos(angle) * power;
                this.vy = Math.sin(angle) * power;
                this.gravity = 0.15;
                this.friction = 0.96;
                this.size = 6 + Math.random() * 12;
                this.color = this.colors[Math.floor(Math.random() * this.colors.length)];
                this.rotation = Math.random() * 360;
                this.rotationSpeed = (Math.random() - 0.5) * 8;
            }
            update() {
                this.vx *= this.friction; this.vy *= this.friction; this.vy += this.gravity;
                this.x += this.vx; this.y += this.vy; this.rotation += this.rotationSpeed;
                return this.y < this.canvas.height + 50;
            }
            draw() {
                this.ctx.save();
                this.ctx.translate(this.x, this.y);
                this.ctx.rotate(this.rotation * Math.PI / 180);
                this.ctx.fillStyle = this.color;
                this.ctx.fillRect(-this.size/2, -this.size/2, this.size, this.size);
                this.ctx.restore();
            }
        }

        let particles = [];
        let animationFrame;

        function startConfetti() {
            const canvas = document.getElementById('confetti-canvas');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            particles = Array.from({ length: 120 }, () => new ConfettiParticle(canvas));
            function loop() {
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                particles.forEach(p => { if(!p.update()) p.reset(); p.draw(); });
                animationFrame = requestAnimationFrame(loop);
            }
            loop();
        }

        function triggerIconAnimation(element, animClass) {
            const icon = element.querySelector('.icon-base, .massive-crown-right');
            if (!icon) return;
            icon.classList.remove('anim-bounce', 'anim-sway', 'anim-spin', 'anim-shake', 'anim-pulse', 'anim-crown');
            void icon.offsetWidth;
            icon.classList.add(animClass);
        }

        function renderSection(category, gridId) {
            const grid = document.getElementById(gridId);
            grid.innerHTML = '';
            inventory[category].forEach(item => {
                const card = document.createElement('div');
                card.className = `premium-card group ${item.isDiamond ? 'diamond-mogul-card' : ''}`;
                card.onclick = (e) => triggerIconAnimation(card, item.anim);
                let iconHtml = item.isDiamond ? `<i class="fas fa-crown massive-crown-right"></i>` : `<i class="${item.icon} icon-base ${item.color}"></i>`;
                card.innerHTML = `
                    <div class="fancy-icon-container" onclick="event.stopPropagation(); triggerIconAnimation(this.parentElement, '${item.anim}')">${iconHtml}</div>
                    <div class="card-content-offset flex flex-col h-full pointer-events-none">
                        <span class="availability-badge ${item.stock <= 3 ? 'bg-red-500/20 text-red-500' : 'bg-green-500/20 text-green-500'}">
                            ${category === 'walks' ? (item.stock + ' Slots Left') : 'Available Now'}
                        </span>
                        <h3 class="card-title">${item.name}</h3>
                        <div class="card-price">${item.price}</div>
                        <p class="card-desc">${item.desc}</p>
                    </div>
                    <button onclick="event.stopPropagation(); bookPlan('${item.id}', '${category}')" class="card-btn pointer-events-auto ${item.isDiamond ? 'bg-yellow-500 text-black' : 'bg-slate-800 text-white'}">
                        Select ${category === 'walks' ? 'Plan' : 'Add-on'}
                    </button>
                `;
                grid.appendChild(card);
            });
        }

        function bookPlan(id, category) {
            const item = inventory[category].find(i => i.id === id);
            if (!item) return;
            currentSelection.main = item;
            currentSelection.addons = []; 
            currentSelection.route = null;
            if (category === 'walks') {
                prepareRouteModal();
                document.getElementById('route-selection-modal').style.display = 'flex';
            } else {
                goToCheckout();
            }
        }

        function prepareRouteModal() {
            const listContainer = document.getElementById('route-list-container');
            listContainer.innerHTML = '';
            inventory.routes.forEach(route => {
                const card = document.createElement('div');
                card.className = "selection-card";
                card.onclick = () => selectRoute(route, card);
                card.innerHTML = `
                    <div class="flex items-center gap-4">
                        <div class="w-10 h-10 rounded-lg bg-white/5 flex items-center justify-center ${route.color}"><i class="fas fa-map-pin"></i></div>
                        <div>
                            <div class="font-bold text-sm text-white">${route.name}</div>
                            <div class="text-[9px] text-slate-500 uppercase font-bold">${route.note}</div>
                        </div>
                    </div>
                `;
                listContainer.appendChild(card);
            });
            document.getElementById('route-next-btn').disabled = true;
        }

        function selectRoute(route, el) {
            currentSelection.route = route;
            document.querySelectorAll('#route-list-container .selection-card').forEach(c => c.classList.remove('selected'));
            el.classList.add('selected');
            const btn = document.getElementById('route-next-btn');
            btn.disabled = false;
            btn.innerText = `Choose ${route.name}`;
            btn.className = "w-full bg-green-500 text-white py-4 rounded-xl font-black text-[10px] uppercase tracking-widest";
        }

        function goToAddons() {
            document.getElementById('route-selection-modal').style.display = 'none';
            prepareAddonModal(currentSelection.main.isDiamond);
            document.getElementById('addon-suggestion-modal').style.display = 'flex';
        }

        function prepareAddonModal(isDiamond) {
            const listContainer = document.getElementById('addon-list-container');
            listContainer.innerHTML = '';
            inventory.addons.forEach(addon => {
                const card = document.createElement('div');
                card.className = "selection-card";
                card.onclick = () => toggleAddon(addon.id, card);
                card.innerHTML = `
                    <div class="flex items-center gap-4">
                        <div class="w-10 h-10 rounded-lg bg-white/5 flex items-center justify-center ${addon.color}"><i class="${addon.icon}"></i></div>
                        <div>
                            <div class="font-bold text-sm text-white">${addon.name}</div>
                            <div class="text-[9px] text-slate-500 uppercase font-bold leading-none">${isDiamond ? 'Included' : '£' + addon.price}</div>
                        </div>
                    </div>
                    <div class="check-icon"><i class="fas fa-check text-green-500 opacity-0 transition-opacity"></i></div>
                `;
                listContainer.appendChild(card);
            });
        }

        function toggleAddon(id, el) {
            const addon = inventory.addons.find(a => a.id === id);
            const index = currentSelection.addons.findIndex(a => a.id === id);
            const check = el.querySelector('.fa-check');
            if (index > -1) {
                currentSelection.addons.splice(index, 1);
                el.classList.remove('selected');
                check.classList.add('opacity-0');
            } else {
                currentSelection.addons.push(addon);
                el.classList.add('selected');
                check.classList.remove('opacity-0');
            }
        }

        function goToCheckout() {
            const { main, addons, route } = currentSelection;
            let totalPrice = main.price;
            let itemList = main.name;
            addons.forEach(a => {
                if (!main.isDiamond) totalPrice += a.price;
                itemList += ` + ${a.name}`;
            });
            document.querySelectorAll('.modal-overlay').forEach(m => m.style.display = 'none');
            document.getElementById('checkout-display-name').innerText = main.name;
            document.getElementById('checkout-amount').innerText = `£${totalPrice}`;
            document.getElementById('checkout-items-list').innerText = itemList;
            document.getElementById('checkout-route-display').innerText = route ? `Route: ${route.name}` : 'Custom Walk';
            document.getElementById('payment-modal').style.display = 'flex';
        }

        function validateEmail() {
            const email = document.getElementById('user-email').value;
            const btn = document.getElementById('confirm-btn');
            const isValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
            btn.disabled = !isValid;
            btn.className = `w-full py-4 rounded-2xl font-black text-xs uppercase tracking-widest transition-all ${isValid ? 'bg-green-500 text-white' : 'bg-slate-800 text-slate-500'}`;
        }

        function handlePurchase() {
            document.querySelectorAll('.modal-overlay').forEach(m => m.style.display = 'none');
            const overlay = document.getElementById('success-overlay');
            overlay.style.display = 'flex';
            startConfetti();
            setTimeout(() => {
                overlay.style.display = 'none';
                cancelAnimationFrame(animationFrame);
            }, 6000);
        }

        function showTab(type) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
            document.getElementById(`${type}-tab`).classList.remove('hidden');
            const btnWalks = document.getElementById('btn-walks');
            const btnAddons = document.getElementById('btn-addons');
            if (type === 'walks') {
                btnWalks.classList.add('bg-green-500', 'text-white');
                btnAddons.classList.remove('bg-green-500', 'text-white');
            } else {
                btnAddons.classList.add('bg-green-500', 'text-white');
                btnWalks.classList.remove('bg-green-500', 'text-white');
            }
        }

        function closeModals() {
            document.querySelectorAll('.modal-overlay').forEach(m => m.style.display = 'none');
        }

        window.onload = () => { 
            renderSection('walks', 'walks-grid'); 
            renderSection('addons', 'addons-grid'); 
            showTab('walks'); 
        };
    </script>
</body>
</html>
